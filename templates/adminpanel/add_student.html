{% extends 'adminpanel/base.html' %}

{% block content %}
<style>
/* Card Styling */
.student-card {
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

/* Table Styling */
.student-table th {
    background: #0d6efd;
    color: #fff;
}
.student-table td, .student-table th {
    vertical-align: middle;
}
.student-table tbody tr:hover {
    background: #f2f8ff;
}
.action-btns a {
    margin-right: 5px;
}
</style>

<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-flex align-items-center mb-4">
        <i class="bi bi-person-plus fs-3 text-primary me-2"></i>
        <h3 class="fw-bold mb-0">Add Student Details</h3>
    </div>

    <!-- Add Student Form -->
    <!-- Add Student Form -->
<div class="card shadow-sm student-card">
    <div class="card-header bg-primary text-white fw-semibold">
        ‚ûï New Student
    </div>
    <div class="card-body">
        <form method="post" enctype="multipart/form-data" class="row g-3">
            {% csrf_token %}

            

            <div class="col-md-3">
                <label class="form-label fw-semibold">Student Name</label>
                <input type="text" name="name" class="form-control" required>
            </div>

            <div class="col-md-3">
                <label class="form-label fw-semibold">Email</label>
                <input type="email" name="email" class="form-control" required>
            </div>

            <div class="col-md-3">
                <label class="form-label fw-semibold">Phone</label>
                <input type="text" name="phone" class="form-control" required>
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">Father Name</label>
                <input type="text" name="father_name" class="form-control" required>
            </div>


            <!-- Documents -->
            <div class="col-md-4">
                <label class="form-label fw-semibold">10th Marksheet</label>
                <input type="file" name="tenth_marksheet" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">12th Marksheet</label>
                <input type="file" name="twelfth_marksheet" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">Aadhaar Card</label>
                <input type="file" name="aadhaar_card" class="form-control">
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">Photo</label>
                <input type="file" name="photo" class="form-control">
            </div>


            <!-- Course -->
<div class="col-md-4">
    <label class="form-label fw-semibold">Course</label>
    <select name="course" id="courseSelect" class="form-control" required>
        <option value="">-- Select Course --</option>
        {% for course in courses %}
            <option value="{{ course.id }}"
                    data-code="{{ course.code }}"
                    data-duration="{{ course.duration }}">
                {{ course.name }} ({{ course.code }})
            </option>
        {% endfor %}
    </select>
</div>


<div class="col-md-4">
    <label class="form-label fw-semibold">Course Code</label>
    <input type="text" name="course_code" id="courseCode"
           class="form-control" readonly>
</div>


            <div class="col-md-4">
    <label class="form-label fw-semibold">Course Duration</label>
    <input type="text" name="course_duration" id="courseDuration"
           class="form-control" readonly>
</div>


            <div class="col-md-4">
                <label class="form-label fw-semibold">Course Session</label>
                <input type="text" name="course_session" class="form-control" placeholder="2024-2025">
            </div>

            <div class="col-md-3">
                <label class="form-label fw-semibold">Roll No</label>
                <input type="text" name="roll_no" class="form-control" required>
            </div>


            <div class="col-md-8">
                <label class="form-label fw-semibold">Address</label>
                <textarea name="address" class="form-control" rows="2"></textarea>
            </div>

            
            <div class="col-md-12">
                <button class="btn btn-success btn-lg mt-3 w-100">
                    ‚ûï Save Student
                </button>
            </div>
        </form>
    </div>
</div>



    <!-- Registered Students Table -->
    <div class="card shadow-sm student-card mt-4">
        <div class="card-header bg-dark text-white fw-semibold">
            üìã Registered Students
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered table-hover student-table mb-0">
                    <thead>
<tr>
    <th>Enrollment_no</th>
    <th>Name</th>
    <th>Father Name</th>
    <th>Email</th>
    <th>Phone</th>
    <th>Address</th>
    <th>Course</th>
    <th>Course Code</th>
    <th>Duration</th>
    <th>Session</th>
    <th>Roll No</th>
    <th>10th</th>
    <th>12th</th>
    <th>Aadhaar</th>
    <th>Photo</th>
    <th>Actions</th>
</tr>
</thead>

                    <tbody>
{% for s in students %}
<tr>
<td class="enrollment_no">{{ s.enrollment_no }}</td>
    <td class="fw-semibold">{{ s.name }}</td>
    <td>{{ s.father_name }}</td>
    <td>{{ s.email }}</td>
    <td>{{ s.phone }}</td>
    <td>{{ s.address }}</td>

    <td>
        {% if s.course %}
            {{ s.course.name }}
        {% else %} N/A {% endif %}
    </td>

    <td>
        {% if s.course %}
            {{ s.course.code }}
        {% else %} N/A {% endif %}
    </td>

    <td>
        {% if s.course %}
            {{ s.course.duration }}
        {% else %} N/A {% endif %}
    </td>

    <td>{{ s.course_session|default:"N/A" }}</td>

        <td>{{s.roll_no}}</td>

    <td>
        {% if s.tenth_marksheet %}
            <a href="{{ s.tenth_marksheet.url }}" target="_blank">View</a>
        {% else %} N/A {% endif %}
    </td>

    <td>
        {% if s.twelfth_marksheet %}
            <a href="{{ s.twelfth_marksheet.url }}" target="_blank">View</a>
        {% else %} N/A {% endif %}
    </td>

    <td>
        {% if s.aadhaar_card %}
            <a href="{{ s.aadhaar_card.url }}" target="_blank">View</a>
        {% else %} N/A {% endif %}
    </td>

    <td>
        {% if s.photo %}
            <img src="{{ s.photo.url }}" width="50" height="50" class="rounded">
        {% else %} N/A {% endif %}
    </td>

    <td class="action-btns">
    <!-- Edit Button -->
    <a href="{% url 'edit_student' s.id %}" class="btn btn-sm btn-primary">‚úèÔ∏è</a>

    <!-- Delete Button -->
    <a href="{% url 'delete_student' s.id %}" class="btn btn-sm btn-danger"
       onclick="return confirm('Delete this student?')">üóë</a>

    <!-- Download Admission Receipt Button -->
    <a href="{% url 'download_admission_receipt' s.id %}" 
       class="btn btn-sm btn-info" target="_blank" title="Download Admission Receipt">
        üìÑ
    </a>
</td>





{% empty %}
<tr>
    <td colspan="15" class="text-center py-4 text-muted">
        No students added yet
    </td>
</tr>
{% endfor %}
</tbody>

                </table>
            </div>
        </div>
    </div>

</div>


<script>
document.getElementById('courseSelect').addEventListener('change', function () {
    let selectedOption = this.options[this.selectedIndex];

    let courseCode = selectedOption.getAttribute('data-code');
    let courseDuration = selectedOption.getAttribute('data-duration');

    document.getElementById('courseCode').value = courseCode ? courseCode : '';
    document.getElementById('courseDuration').value = courseDuration ? courseDuration : '';
});
</script>

{% endblock %}
